<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DG Monitoring System Dashboard</title>
<style>
  /* Root Variables */
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-tertiary: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;
    --border: #334155;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 20px;
    background: var(--bg-primary);
    font-family: 'Inter', sans-serif;
    color: var(--text-primary);
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
    font-weight: 700;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    gap: 20px;
  }
  .metric-card {
    background: var(--bg-secondary);
    border-radius: 10px;
    box-shadow: var(--shadow);
    padding: 15px 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: center;
    transition: background 0.3s ease;
  }
  .metric-card:hover {
    background: var(--bg-tertiary);
  }
  .metric-label {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 7px;
    font-weight: 600;
  }
  .metric-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--text-primary);
  }
  .metric-unit {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-top: 4px;
  }
  /* Color variants for diesel and electrical */
  .diesel { border-left: 6px solid var(--success); }
  .electrical { border-left: 6px solid var(--primary); }

  /* Dashboard Sections */
  .section-title {
    font-size: 1.4rem;
    margin: 30px 0 15px 0;
    border-bottom: 2px solid var(--primary);
    padding-bottom: 6px;
  }

  /* Responsive adjustments */
  @media (max-width: 600px) {
    .metric-value {
      font-size: 2rem;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>DG Monitoring System Dashboard</h1>

    <!-- Diesel Overview -->
    <div class="section-title">Diesel Levels (Liters)</div>
    <div class="metrics-grid" id="diesel-metrics">
      <div class="metric-card diesel">
        <div class="metric-label">DG-1 Diesel Level</div>
        <div class="metric-value" id="dg1">--</div>
        <div class="metric-unit">L</div>
      </div>
      <div class="metric-card diesel">
        <div class="metric-label">DG-2 Diesel Level</div>
        <div class="metric-value" id="dg2">--</div>
        <div class="metric-unit">L</div>
      </div>
      <div class="metric-card diesel">
        <div class="metric-label">DG-3 Diesel Level</div>
        <div class="metric-value" id="dg3">--</div>
        <div class="metric-unit">L</div>
      </div>
      <div class="metric-card diesel">
        <div class="metric-label">Total Diesel</div>
        <div class="metric-value" id="total">--</div>
        <div class="metric-unit">L</div>
      </div>
    </div>

    <!-- Electrical Overview -->
    <div class="section-title">Electrical Parameters</div>

    <h3>Voltage (Volts)</h3>
    <div class="metrics-grid" id="electrical-voltage">
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Voltage R-Phase</div>
        <div class="metric-value" id="dg1-voltage-r">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Voltage Y-Phase</div>
        <div class="metric-value" id="dg1-voltage-y">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Voltage B-Phase</div>
        <div class="metric-value" id="dg1-voltage-b">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Voltage R-Phase</div>
        <div class="metric-value" id="dg2-voltage-r">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Voltage Y-Phase</div>
        <div class="metric-value" id="dg2-voltage-y">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Voltage B-Phase</div>
        <div class="metric-value" id="dg2-voltage-b">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Voltage R-Phase</div>
        <div class="metric-value" id="dg3-voltage-r">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Voltage Y-Phase</div>
        <div class="metric-value" id="dg3-voltage-y">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Voltage B-Phase</div>
        <div class="metric-value" id="dg3-voltage-b">--</div>
      </div>
    </div>

    <h3>Current (Amperes)</h3>
    <div class="metrics-grid" id="electrical-current">
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Current R-Phase</div>
        <div class="metric-value" id="dg1-current-r">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Current Y-Phase</div>
        <div class="metric-value" id="dg1-current-y">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Current B-Phase</div>
        <div class="metric-value" id="dg1-current-b">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Current R-Phase</div>
        <div class="metric-value" id="dg2-current-r">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Current Y-Phase</div>
        <div class="metric-value" id="dg2-current-y">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Current B-Phase</div>
        <div class="metric-value" id="dg2-current-b">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Current R-Phase</div>
        <div class="metric-value" id="dg3-current-r">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Current Y-Phase</div>
        <div class="metric-value" id="dg3-current-y">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Current B-Phase</div>
        <div class="metric-value" id="dg3-current-b">--</div>
      </div>
    </div>

    <h3>Other Electrical Parameters</h3>
    <div class="metrics-grid" id="electrical-other">
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Frequency (Hz)</div>
        <div class="metric-value" id="dg1-frequency">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Power Factor</div>
        <div class="metric-value" id="dg1-power-factor">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Active Power (kW)</div>
        <div class="metric-value" id="dg1-active-power">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-1 Reactive Power (kVAR)</div>
        <div class="metric-value" id="dg1-reactive-power">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Frequency (Hz)</div>
        <div class="metric-value" id="dg2-frequency">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Power Factor</div>
        <div class="metric-value" id="dg2-power-factor">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Active Power (kW)</div>
        <div class="metric-value" id="dg2-active-power">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-2 Reactive Power (kVAR)</div>
        <div class="metric-value" id="dg2-reactive-power">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Frequency (Hz)</div>
        <div class="metric-value" id="dg3-frequency">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Power Factor</div>
        <div class="metric-value" id="dg3-power-factor">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Active Power (kW)</div>
        <div class="metric-value" id="dg3-active-power">--</div>
      </div>
      <div class="metric-card electrical">
        <div class="metric-label">DG-3 Reactive Power (kVAR)</div>
        <div class="metric-value" id="dg3-reactive-power">--</div>
      </div>
    </div>

  </div>

  <script>
    async function fetchData() {
      try {
        const response = await fetch('/api/data');
        if (!response.ok) throw new Error('Network response was not OK');
        return await response.json();
      } catch (err) {
        console.error('Fetch error:', err);
        return null;
      }
    }

    function updateDiesel(data) {
      document.getElementById('dg1').textContent = data.dg1 ?? '--';
      document.getElementById('dg2').textContent = data.dg2 ?? '--';
      document.getElementById('dg3').textContent = data.dg3 ?? '--';
      document.getElementById('total').textContent = data.total ?? '--';
    }

    function updateElectrical(data) {
      if (!data.electrical) return;
      ['dg1', 'dg2', 'dg3'].forEach(dg => {
        const e = data.electrical[dg] || {};
        // Voltage
        document.getElementById(dg + '-voltage-r').textContent = formatNum(e.voltageR);
        document.getElementById(dg + '-voltage-y').textContent = formatNum(e.voltageY);
        document.getElementById(dg + '-voltage-b').textContent = formatNum(e.voltageB);
        // Current
        document.getElementById(dg + '-current-r').textContent = formatNum(e.currentR);
        document.getElementById(dg + '-current-y').textContent = formatNum(e.currentY);
        document.getElementById(dg + '-current-b').textContent = formatNum(e.currentB);
        // Other params
        document.getElementById(dg + '-frequency').textContent = formatNum(e.frequency);
        document.getElementById(dg + '-power-factor').textContent = formatNum(e.powerFactor, 2);
        document.getElementById(dg + '-active-power').textContent = formatNum(e.activePower);
        document.getElementById(dg + '-reactive-power').textContent = formatNum(e.reactivePower);
      });
    }

    function formatNum(num, decimals = 1) {
      if (num === undefined || num === null) return '--';
      if (isNaN(num)) return '--';
      return num.toFixed(decimals);
    }

    async function refresh() {
      const data = await fetchData();
      if (!data) return;
      updateDiesel(data);
      updateElectrical(data);
    }

    setInterval(refresh, 3000);
    refresh(); // Initial load
  </script>
</body>
</html>
