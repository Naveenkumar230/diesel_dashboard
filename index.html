<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DG Monitor</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #fff;
    padding: 20px;
    min-height: 100vh;
  }
  .container { max-width: 1200px; margin: 0 auto; }
  
  .header {
    text-align: center;
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    margin-bottom: 30px;
  }
  h1 { font-size: 2rem; margin-bottom: 10px; }
  .status { font-size: 0.9rem; opacity: 0.8; }
  
  .diesel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }
  
  .card {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    transition: transform 0.3s;
  }
  .card:hover { transform: translateY(-5px); }
  
  .card-label {
    font-size: 0.85rem;
    opacity: 0.7;
    margin-bottom: 10px;
    text-transform: uppercase;
  }
  .card-value {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
  }
  .card-unit { font-size: 0.9rem; opacity: 0.6; }
  
  .critical { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; }
  .warning { background: rgba(245, 158, 11, 0.2); border: 2px solid #f59e0b; }
  .ok { background: rgba(16, 185, 129, 0.2); border: 2px solid #10b981; }
  
  .section-title {
    font-size: 1.3rem;
    margin: 30px 0 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(255,255,255,0.2);
  }
  
  .phase-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
  }
  
  .phase-card {
    background: rgba(255,255,255,0.05);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }
  .phase-label {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-bottom: 8px;
  }
  .phase-value {
    font-size: 1.5rem;
    font-weight: bold;
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚ö° DG Monitoring System</h1>
      <div class="status">Last Updated: <span id="lastUpdate">--</span></div>
    </div>

    <!-- Diesel Levels -->
    <div class="section-title">üõ¢Ô∏è Diesel Levels</div>
    <div class="diesel-grid">
      <div class="card" id="card-dg1">
        <div class="card-label">DG-1</div>
        <div class="card-value" id="dg1">--</div>
        <div class="card-unit">Liters</div>
      </div>
      <div class="card" id="card-dg2">
        <div class="card-label">DG-2</div>
        <div class="card-value" id="dg2">--</div>
        <div class="card-unit">Liters</div>
      </div>
      <div class="card" id="card-dg3">
        <div class="card-label">DG-3</div>
        <div class="card-value" id="dg3">--</div>
        <div class="card-unit">Liters</div>
      </div>
      <div class="card ok">
        <div class="card-label">Total</div>
        <div class="card-value" id="total">--</div>
        <div class="card-unit">Liters</div>
      </div>
    </div>

    <!-- DG-1 Parameters -->
    <div class="section-title">‚öôÔ∏è DG-1 Electrical</div>
    <div class="phase-grid">
      <div class="phase-card">
        <div class="phase-label">Voltage R</div>
        <div class="phase-value" id="dg1-vr">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage Y</div>
        <div class="phase-value" id="dg1-vy">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage B</div>
        <div class="phase-value" id="dg1-vb">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current R</div>
        <div class="phase-value" id="dg1-cr">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current Y</div>
        <div class="phase-value" id="dg1-cy">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current B</div>
        <div class="phase-value" id="dg1-cb">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Frequency</div>
        <div class="phase-value" id="dg1-freq">--</div>
        <div class="card-unit">Hz</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Power Factor</div>
        <div class="phase-value" id="dg1-pf">--</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Active Power</div>
        <div class="phase-value" id="dg1-ap">--</div>
        <div class="card-unit">kW</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Reactive Power</div>
        <div class="phase-value" id="dg1-rp">--</div>
        <div class="card-unit">kVAR</div>
      </div>
    </div>

    <!-- DG-2 Parameters -->
    <div class="section-title">‚öôÔ∏è DG-2 Electrical</div>
    <div class="phase-grid">
      <div class="phase-card">
        <div class="phase-label">Voltage R</div>
        <div class="phase-value" id="dg2-vr">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage Y</div>
        <div class="phase-value" id="dg2-vy">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage B</div>
        <div class="phase-value" id="dg2-vb">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current R</div>
        <div class="phase-value" id="dg2-cr">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current Y</div>
        <div class="phase-value" id="dg2-cy">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current B</div>
        <div class="phase-value" id="dg2-cb">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Frequency</div>
        <div class="phase-value" id="dg2-freq">--</div>
        <div class="card-unit">Hz</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Power Factor</div>
        <div class="phase-value" id="dg2-pf">--</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Active Power</div>
        <div class="phase-value" id="dg2-ap">--</div>
        <div class="card-unit">kW</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Reactive Power</div>
        <div class="phase-value" id="dg2-rp">--</div>
        <div class="card-unit">kVAR</div>
      </div>
    </div>

    <!-- DG-3 Parameters -->
    <div class="section-title">‚öôÔ∏è DG-3 Electrical</div>
    <div class="phase-grid">
      <div class="phase-card">
        <div class="phase-label">Voltage R</div>
        <div class="phase-value" id="dg3-vr">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage Y</div>
        <div class="phase-value" id="dg3-vy">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage B</div>
        <div class="phase-value" id="dg3-vb">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current R</div>
        <div class="phase-value" id="dg3-cr">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current Y</div>
        <div class="phase-value" id="dg3-cy">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current B</div>
        <div class="phase-value" id="dg3-cb">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Frequency</div>
        <div class="phase-value" id="dg3-freq">--</div>
        <div class="card-unit">Hz</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Power Factor</div>
        <div class="phase-value" id="dg3-pf">--</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Active Power</div>
        <div class="phase-value" id="dg3-ap">--</div>
        <div class="card-unit">kW</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Reactive Power</div>
        <div class="phase-value" id="dg3-rp">--</div>
        <div class="card-unit">kVAR</div>
      </div>
    </div>

    <!-- DG-4 Parameters -->
    <div class="section-title">‚öôÔ∏è DG-4 Electrical</div>
    <div class="phase-grid">
      <div class="phase-card">
        <div class="phase-label">Voltage R</div>
        <div class="phase-value" id="dg4-vr">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage Y</div>
        <div class="phase-value" id="dg4-vy">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Voltage B</div>
        <div class="phase-value" id="dg4-vb">--</div>
        <div class="card-unit">V</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current R</div>
        <div class="phase-value" id="dg4-cr">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current Y</div>
        <div class="phase-value" id="dg4-cy">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Current B</div>
        <div class="phase-value" id="dg4-cb">--</div>
        <div class="card-unit">A</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Frequency</div>
        <div class="phase-value" id="dg4-freq">--</div>
        <div class="card-unit">Hz</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Power Factor</div>
        <div class="phase-value" id="dg4-pf">--</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Active Power</div>
        <div class="phase-value" id="dg4-ap">--</div>
        <div class="card-unit">kW</div>
      </div>
      <div class="phase-card">
        <div class="phase-label">Reactive Power</div>
        <div class="phase-value" id="dg4-rp">--</div>
        <div class="card-unit">kVAR</div>
      </div>
    </div>
  </div>

  <script>
    const CRITICAL = 50;
    const WARNING = 100;

    function fmt(val, dec = 1) {
      return val != null && !isNaN(val) ? val.toFixed(dec) : '--';
    }

    function updateUI(data) {
      // Diesel levels
      ['dg1', 'dg2', 'dg3'].forEach(dg => {
        const val = data[dg] || 0;
        document.getElementById(dg).textContent = fmt(val, 0);
        
        const card = document.getElementById(`card-${dg}`);
        card.className = 'card';
        if (val <= CRITICAL) card.classList.add('critical');
        else if (val <= WARNING) card.classList.add('warning');
        else card.classList.add('ok');
      });
      
      document.getElementById('total').textContent = fmt(data.total, 0);

      // Electrical parameters
      if (data.electrical) {
        ['dg1', 'dg2', 'dg3'].forEach(dg => {
          const e = data.electrical[dg] || {};
          document.getElementById(`${dg}-vr`).textContent = fmt(e.voltageR);
          document.getElementById(`${dg}-vy`).textContent = fmt(e.voltageY);
          document.getElementById(`${dg}-vb`).textContent = fmt(e.voltageB);
          document.getElementById(`${dg}-cr`).textContent = fmt(e.currentR);
          document.getElementById(`${dg}-cy`).textContent = fmt(e.currentY);
          document.getElementById(`${dg}-cb`).textContent = fmt(e.currentB);
          document.getElementById(`${dg}-freq`).textContent = fmt(e.frequency);
          document.getElementById(`${dg}-pf`).textContent = fmt(e.powerFactor, 2);
          document.getElementById(`${dg}-ap`).textContent = fmt(e.activePower);
          document.getElementById(`${dg}-rp`).textContent = fmt(e.reactivePower);
        });
      }

      document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
    }

    async function fetchData() {
      try {
        const res = await fetch('/api/data');
        if (res.ok) {
          const data = await res.json();
          updateUI(data);
        }
      } catch (err) {
        console.error('Fetch error:', err);
      }
    }

    fetchData();
    setInterval(fetchData, 3000);
  </script>
</body>
</html>